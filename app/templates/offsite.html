{% define "title" %}Attend Offsite{% end %}

{% define "mastheadBgClass" %}bg-cyan{% end %}

{% define "masthead" %}
  <!-- <div class="photo__masthead photo__masthead--fullbleed" fit>
  <div class="card__photo--stage"></div> -->
  <h1><i18n-msg msgid="attend-offsite">Attend Offsite</i18n-msg></h1>
</div>
{% end %}

{% define "content" %}
  <paper-toolbar class="navbar__overlay navbar__overlay--video" aria-hidden$="{{!fullscreenVideoActive}}" fit>
    <paper-icon-button icon="arrow-back" on-tap="closeVideoSection"
        aria-label="Close video"
        tabindex="{{_enableTabIndex(fullscreenVideoActive)}}"></paper-icon-button>
    <span flex>Watch the 2014 I/O Extended recap video</span>
  </paper-toolbar>

  <paper-toolbar class="navbar__overlay navbar__overlay--gallery"
                 aria-hidden$="{{!photoGalleryActive}}" fit>
    <paper-icon-button icon="arrow-back" on-tap="closeExtendedPhotoGallery"
        aria-label="Close gallery"
        tabindex="{{_enableTabIndex(photoGalleryActive)}}"></paper-icon-button>
    <span flex>I/O Extended Photos</span>
  </paper-toolbar>

<!--   <paper-toolbar class="navbar__overlay navbar__overlay--extended"
      aria-hidden$="{{!extendedMapActive}}" fit>
    <paper-icon-button icon="arrow-back" on-tap="closeExtendedMapSection"
        aria-label="Close extended map"
        tabindex="{{_enableTabIndex(extendedMapActive)}}"></paper-icon-button>
    <span flex>2015 Extended events</span>
  </paper-toolbar> -->

  <io-gallery hidden$="{{!photoGalleryActive}}"
              mobile="[[isPhoneSize]]"
              image-path="media.image.url"
              active="{{photoGalleryActive}}" fit></io-gallery>

  <template is="dom-if" if="{{fullscreenVideoActive}}" restamp>
    <div class="fullvideo__container" fit>
     <google-youtube video-id="A-bjrru5bLU" height="100%" width="100%" fit
                     autohide="1" controls="2" modestbranding="1" showinfo="0"
                     iv_load_policy="3" rel="0" autoplay="1"
                     on-google-youtube-ready="onOffsiteVideoReady"></google-youtube>
    </div>
  </template>

<div class="active">

<div class="card__container card__container--top sidebyside slide-up"
     layout horizontal vertical$="{{isPhoneSize}}" relative>
    <div class="card" layout vertical auto-vertical flex>
      <div class="card-content" flex$="{{!isPhoneSize}}">
        <h3 class="card__title">Live stream</h3>
        <div>Watch the keynote and select sessions in real-time, from your laptop or mobile device.</div>
      </div>
      <div class="card-content">
        <a href="schedule?filters=Live%20streamed#day1" data-track-link="offsite-browse-schedule" data-ajax-link data-transition="hero-card-transition">Browse Live Schedule</a>
      </div>
    </div>
    <div class="card" auto-vertical flex>
      <div class="card-content">
        <h3 class="card__title">I/O Live Embed Widget</h3>
        <div>Personalize the I/O live stream for your website and share the #io15 conversation from the event with your audience.</div>
      </div>
      <div class="card-content">
        <a href="widget" data-track-link="offsite-widget" data-ajax-link data-transition="hero-card-transition">Customize I/O Live widget</a>
      </div>
    </div>
    <div class="ripple">
      <div class="ripple__content"></div>
    </div>
  </div>


  <div class="slide-up-delay">
    <section class="card__photo--stage page__section js-experiment-instrument" layout vertical center-center>
      <div class="play__button__container" on-tap="openSectionVideo" data-track-link="offsite-watch-extended-recap-video">
        <h5><i18n-msg msgid="ioextendedwatch">Watch the 2014 I/O Extended recap video</i18n-msg></h5>
      </div>
    </section>

    <div class="card__container" relative>
      <div class="card" auto-vertical flex>
        <div class="card-content">
          <h3 class="card__title">I/O Extended events</h3>
          <div>I/O Extended events may include live streamed sessions, local developer demos, hackathons and more. These events are brought to you by our Google Developer Groups, Student Ambassadors, and local developers.</div>
        </div>
      </div>
    </div>

  </div>

  <div class="card__container card__iorequest">
    <div class="card" auto-vertical flex>
      <div class="card-content">
        <h3 class="card__title">#io15request</h3>
        <p>Developers and product fans who are unable to attend Google I/O in-person are invited to participate in the <b>#io15request</b> program. During conference days, you can request images, information, and answers to your burning I/O questions, and a team of onsite Googlers will do their best to hunt down an answer for you.</p>
        <div>To put in a request during I/O (May 28-29), all you need to do is create a <b>public</b> Google+ or Twitter post from your profile using the hashtag <b>#io15request</b>. We'll only be able to reply to requests written in English, French and German.</div>
      </div>
      <div class="card-content link-spacing">
        <a href="https://plus.google.com/+topcontributors/" data-track-link="offsite-iorequest-gplus" target="_blank">See #io15requests on Google+</a>
        <a href="https://twitter.com/search?f=realtime&q=%23io15request&src=typd" data-track-link="offsite-iorequest-twitter" target="_blank">See #io15requests on Twitter</a>
      </div>
    </div>
  </div>

  <section id="hashtag" class="page__section">
    <div class="io__hash"></div>
  </section>

</div>
 <!--  <div class="active">

    <div class="card__container card__container--top slide-up">
      <div class="card">
        <div class="card-content">
          <h3>Developers and product fans from all over the world were also able to watch and participate in I/O 2015 through I/O Extended events.</h3>
        </div>
        <div class="card-content anchor-like">
          <span role="link" tabindex="0" data-track-link="offsite-photos-extended"
                on-tap="toggleExtendedGallery">See photos from I/O extended</span>
        </div>
      </div>
    </div>

    <div class="slide-up-delay">

      <section class="page__section pics__section" layout vertical>
        <div layout horizontal>
          <div class="photo__home" flex two$="{{isDesktopSize}}"></div>
          <div layout vertical flex>
            <div class="photo__home--top" flex></div>
            <div class="photo__home--bottom" flex></div>
          </div>
        </div>
      </section>

    </div>

  </div> -->

  <script>
  (function() {

    var ANIMATION_DURATION = 500;

    function runVideoSectionAnimation(opt_reverse, opt_callback) {
      var topCard = IOWA.Elements.Main.querySelector('.card__container.slide-up');

      var videoContainer = document.querySelector('.fullvideo__container');
      var video = videoContainer.querySelector('google-youtube');

      // Wait for cc module to load, then make the fontsize smaller.
      // https://developers.google.com/youtube/iframe_api_reference#Events
      var callback = function() {
        video._player.setOption('captions', 'fontSize', -2);
        video._player.removeEventListener('onApiChange', callback);
      };
      video._player.addEventListener('onApiChange', callback);

      var animationTiming = {
        duration: ANIMATION_DURATION,
        fill: 'forwards',
        direction: opt_reverse ? 'reverse' : 'normal',
        easing: 'cubic-bezier(0.4,0,0.2,1)'
      };

      var button = IOWA.Elements.Main.querySelector('.play__button__container');

      var animation = new KeyframeEffect(button, [
        {opacity: 1}, {opacity: 0}
      ], animationTiming);

      // Only animate top/bottom cards offscreen if not on mobile.
      if (!IOWA.Elements.Template.isPhoneSize) {
        animation = new GroupEffect([
          animation,
          new KeyframeEffect(topCard, [
            {transform: 'translateY(0)', opacity: 1},
            {transform: 'translateY(-100px)', opacity: 0}
          ], animationTiming)
        ]);
      }

      var videoAnimation = new KeyframeEffect(video, [
        {opacity: 0}, {opacity: 1}
      ], animationTiming);

      var navOverlay = document.querySelector('.navbar__overlay--video');

      if (opt_reverse) {
        // Fade out gallery and slide back in page sections at the same time.
        IOWA.PageAnimation.play(new GroupEffect([
          animation, videoAnimation
        ]), opt_callback);
        navOverlay.classList.remove('active');
      } else {
        // Slide out page sections, then fade in gallery.
        IOWA.PageAnimation.play(new SequenceEffect([
          animation, videoAnimation
        ]), opt_callback);
        navOverlay.classList.add('active');
      }
    }

    function runExtendedMapAnimation(opt_reverse, opt_callback) {
      var viewButton = IOWA.Elements.Main.querySelector('.view__events');
      var searchInput = IOWA.Elements.Main.querySelector('.search__map');
      var sectionTitle = IOWA.Elements.Main.querySelector('.extended-title');

      var animationTiming = {
        duration: ANIMATION_DURATION,
        fill: 'forwards',
        direction: opt_reverse ? 'reverse' : 'normal',
        easing: 'cubic-bezier(0.4,0,0.2,1)'
      };

      var animation = new GroupEffect([
        new KeyframeEffect(viewButton, [
          {opacity: 1, visibility: 'visible', 'pointer-events': 'auto'},
          {opacity: 0, visibility: 'hidden', 'pointer-events': 'none'}
        ], animationTiming),
        new KeyframeEffect(sectionTitle, [
          {opacity: 1, visibility: 'visible'},
          {opacity: 0, visibility: 'hidden'}
        ], animationTiming)
      ]);

      var searchInputAnimation = new KeyframeEffect(searchInput, [
        {opacity: 0, visibility: 'hidden'},
        {opacity: 1, visibility: 'visible'}
      ], animationTiming);

      var navOverlay = document.querySelector('.navbar__overlay--extended');

      if (opt_reverse) {
        // Fade in button, and bring back cards at same time.
        IOWA.PageAnimation.play(new GroupEffect([
          animation, searchInputAnimation
        ]), opt_callback);
        navOverlay.classList.remove('active');
      } else {
        // Dismiss cards offscreen, then fade in search input.
        IOWA.PageAnimation.play(new SequenceEffect([
          animation, searchInputAnimation
        ]), opt_callback);
        navOverlay.classList.add('active');
      }
    }

    function runExtendedGalleryAnimation(opt_reverse, opt_callback) {
      var navOverlay = document.querySelector('.navbar__overlay--gallery');

      var reverse = opt_reverse || false;

      var gallery = IOWA.Elements.Main.querySelector('io-gallery');
      var animation = new KeyframeEffect(gallery, [
        {opacity: 0}, {opacity: 1}
      ], {
        duration: 500,
        fill: 'forwards',
        direction: reverse ? 'reverse' : 'normal',
        easing: 'cubic-bezier(0.4,0,0.2,1)'
      });

      IOWA.PageAnimation.play(animation, opt_callback);

      if (reverse) {
        navOverlay.classList.remove('active');
      } else {
        navOverlay.classList.add('active');
      }
    }

    // Page-specific JS that runs when this page is loaded for the first time.
    function initPage() {
      var page = IOWA.Elements.Template.pages['offsite'];

      if (page.hasBeenLoaded) {
        return;
      }

      page.load = function() {
        // Reset template variables for when revisiting the page.
        IOWA.Elements.Template.offsiteGlobeVisible = false;
        IOWA.Elements.Template.photoGalleryActive = false;
        IOWA.Elements.Template.fullscreenVideoActive = false;
        IOWA.Elements.Template.extendedMapActive = false;
        IOWA.Elements.Template.politicalAreaSearch = false;
        IOWA.Elements.Template.didExtendedSearch = false;
        IOWA.Elements.Template.webglSupported = true;
        IOWA.Elements.Template.offsiteMarkerResults= [];

        // Offsite event search radius in kilometers.
        IOWA.Elements.Template.offsiteSearchRadius = 150;
      };

      page.onPageTransitionDone = function() {
        var gallery = IOWA.Elements.Main.querySelector('io-gallery');
        if (!gallery.items.length) {
          IOWA.Picasa.fetchExtendedPhotos(function(photos) {
            gallery.items = photos;
          });
        }

        if (location.hash.substring(1) == 'photos') {
          IOWA.Elements.Template.toggleExtendedGallery(e);
        }
      };

      IOWA.Elements.Template.closeExtendedPhotoGallery = function(e, detail) {
        runExtendedGalleryAnimation(true, function() {
          IOWA.Elements.Template.photoGalleryActive = false;
        });

        history.replaceState({}, null, location.pathname); // Remove #photos hash from URL.
      };

      IOWA.Elements.Template.toggleExtendedGallery = function(e, detail) {
        e.preventDefault();

        var target = Polymer.dom(e).rootTarget;

        if (target && target.hasAttribute('data-track-link')) {
          IOWA.Analytics.trackEvent(
              'link', 'click', target.getAttribute('data-track-link'));
        } else {
          IOWA.Analytics.trackEvent('link', 'click', 'onsite-photos-extended-deeplink');
        }

        if (!this.photoGalleryActive) {
          this.photoGalleryActive = true;
          runExtendedGalleryAnimation();
        } else {
          runExtendedGalleryAnimation(true); // reverse animation when gallery is open.
          this.photoGalleryActive = false;
        }
      };

      IOWA.Elements.Template.onOffsiteVideoReady = function(e, detail) {
        runVideoSectionAnimation();
      };

      IOWA.Elements.Template.closeVideoSection = function(e, detail) {
        runVideoSectionAnimation(true, function() {
          IOWA.Elements.Template.fullscreenVideoActive = false;
        });
      };

      IOWA.Elements.Template.openSectionVideo = function(e, detail) {
        var target = Polymer.dom(e).rootTarget;

        IOWA.Analytics.trackEvent(
            'link', 'click', target.getAttribute('data-track-link'));

        // Only smooth scroll to content if not on mobile.
        if (IOWA.Elements.Template.isPhoneSize) {
          this.fullscreenVideoActive = true; // stamp template
        } else {
          var videoStage = IOWA.Elements.Main.querySelector('.card__photo--stage');
          IOWA.Util.smoothScroll(videoStage, 300, function() {
            this.fullscreenVideoActive = true; // stamp template
          }.bind(this));
        }
      };

      page.load(); // Run load callback on page load.
      page.hasBeenLoaded = true;
    }

    // IE will be "loading" at this point. Other browsers will already be "complete".
    if (document.readyState !== 'loading') {
      initPage();
    }

    // Necessary for IE's lack of native <template>
    // https://github.com/GoogleChrome/ioweb2015/issues/599
    window._initPage = initPage;

  })();
  </script>
{% end %}
