{% define "title" %}Schedule{% end %}

{% define "mastheadBgClass" %}bg-cyan{% end %}

{% define "selectedSubpage" %}agenda{% end %}

{% define "masthead" %}
  <h1>Schedule</h1>
  <div layout horizontal justified>
    <paper-tabs id="subpage-tabs" class="white" selected="{{pages[selectedPage].selectedSubpage}}" valueattr="label"
                scrollable?="{{isPhoneSize}}" link>
      <paper-tab label="agenda">
        <a href="#agenda" data-track-link="schedule-agenda" data-subpage-link
                          layout horizontal center-center>Agenda</a>
      </paper-tab>
      <paper-tab label="day1">
        <a href="#day1" data-track-link="schedule-day1" data-subpage-link
                        layout horizontal center-center>Day 1</a>
      </paper-tab>
      <paper-tab label="day2">
        <a href="#day2" data-track-link="schedule-day2" data-subpage-link
                        layout horizontal center-center>Day 2</a>
      </paper-tab>
      <paper-tab label="mysched">
        <a href="#mysched" data-track-link="schedule-mysched" data-subpage-link
                           layout horizontal center-center>My Schedule</a>
      </paper-tab>
    </paper-tabs>
    <paper-dropdown-menu>
      <paper-dropdown class="dropdown" halign="right">
        <core-menu class="menu" selected="1">
          <paper-item>PST</paper-item>
          <paper-item>MST</paper-item>
          <paper-item>CST</paper-item>
          <paper-item>EST</paper-item>
          <paper-item>GMT</paper-item>
        </core-menu>
      </paper-dropdown>
    </paper-dropdown-menu>
  </div>
{% end %}

{% define "content" %}

<paper-dialog class="session__detail" transition="core-transition-center" layered="false" backdrop
              on-core-overlay-close-completed="{{onSessionDetailsClose}}">
  <paper-icon-button icon="arrow-back" core-overlay-toggle aria-label="Close session"></paper-icon-button>
  <div class="card__photo" relative>
    <core-image src="{{selectedSession.photoUrl || 'images/schedule/sessiondetail@2x.jpg'}}"
                placeholder="images/io15-color.png"
                sizing="cover" preload fade fit></core-image>
    <paper-fab icon="{{selectedSession.saved ? 'check' : 'add'}}"
               mini?="{{isPhoneSize}}" class="{{ {active: selectedSession.saved} | tokenList }}"
               on-click="{{toggleSaveSession}}"></paper-fab>
  </div>
  <div class="session__info__section">
    <h2 class="session__title">{{selectedSession.title}}</h2>
    <h5 class="session__time">{{selectedSession.startTimestamp | formatSessionDateFilter}} / {{selectedSession.startTimestamp | formatSessionTimeFilter}} - {{selectedSession.endTimestamp | formatSessionTimeFilter}} / {{scheduleData.rooms[selectedSession.room].name}}</h5>
    <h5 class="session__categories">{{selectedSession.tags | formatSessionTagsFilter}}</h5>
    <div class="session__desc">{{selectedSession.description}}</div>
    <div class="session__social" layout horizontal>
      <a href="#" target="_blank" class="share-icon" data-share-type="gplus" on-click="{{openShareWindow}}">
        <core-icon icon="io:post-gplus"></core-icon>
      </a>
      <a href="#" target="_blank" class="share-icon" data-share-type="twitter" on-click="{{openShareWindow}}">
        <core-icon icon="io:post-twitter"></core-icon>
      </a>
      <a href="#" target="_blank" class="share-icon" data-share-type="facebook" on-click="{{openShareWindow}}">
        <core-icon icon="io:post-facebook"></core-icon>
      </a>
      <span flex class="session__livestream" hidden?="{{!selectedSession.isLivestream}}">Live streamed <core-icon icon="io:videocam"></core-icon></span>
    </div>
  </div>
  <div class="session__info__section session__speakers">
    <h4>Speakers</h4>
    <div layout horizontal wrap>

      <template repeat="{{speakerId in selectedSession.speakers}}">
        <div class="speaker__card" layout horizontal>
          <div><img _src="{{scheduleData.speakers[speakerId].thumbnailUrl || 'images/touch/homescreen96.png'}}" class="profilepic"></div>
          <div class="speaker__info" layout vertical flex>
            <span class="speaker__name">{{scheduleData.speakers[speakerId].name}}</span>
            <span class="speaker__title">{{scheduleData.speakers[speakerId].company}}</span>
            <div class="speaker__desc">{{scheduleData.speakers[speakerId].bio}}</div>
            <div class="session__social" layout horizontal>
              <a href="{{scheduleData.speakers[speakerId].plusoneUrl}}" target="_blank" class="share-icon" hidden?="{{!scheduleData.speakers[speakerId].plusoneUrl}}"><core-icon icon="io:post-gplus"></core-icon></a>
              <a href="{{scheduleData.speakers[speakerId].twitterUrl}}" target="_blank" class="share-icon" hidden?="{{!scheduleData.speakers[speakerId].twitterUrl}}"><core-icon icon="io:post-twitter"></core-icon></a>
            </div>
          </div>
        </div>
      </template>

    </div>
  </div>
  <div class="session__info__section card-content">
    <a href="#" data-track-link="schedule-detail-view-related" core-overlay-toggle>View related sessions</a>
  </div>
</paper-dialog>

<div class="subpage__container">
  <section id="subpage-agenda"
      class="subpage__content {{ {active: pages[selectedPage].selectedSubpage == 'agenda'} | tokenList}}">
    <section class="page__section page__section--top slide-up">
        <div class="card__container card__container--top">
          <div class="card js-experiment-visualizer">
            <div class="card-content">
              <h4><i18n-msg msgid="iomonth">May</i18-msg> 27, 2015</h4>
            </div>
            <div class="card-content">
              <div layout horizontal>
                <core-icon icon="schedule" aria-hidden="true"></core-icon>
                <div class="schedule-rows">
                  <div layout vertical?="{{isPhoneSize}}" horizontal?="{{!isPhoneSize}}">
                    <span class="schedule-time" auto-vertical flex>9:00 AM - 6:00 PM</span>
                    <span auto-vertical flex two><i18n-msg msgid="badge-pickup">Badge pick-up</i18-msg></span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
      <div class="slide-up-delay">
        <section class="page__section">
          <div class="card__container card__container--top">
            <div class="card js-experiment-visualizer">
              <div class="card-content">
                <h4><i18n-msg msgid="iomonth">May</i18-msg> 28, 2015</h4>
              </div>
              <div class="card-content">
                <div layout horizontal>
                  <core-icon icon="schedule" aria-hidden="true"></core-icon>
                  <div class="schedule-rows">
                    <div layout vertical?="{{isPhoneSize}}" horizontal?="{{!isPhoneSize}}">
                      <span class="schedule-time" auto-vertical flex>8:00 AM - 9:00 AM</span>
                      <span auto-vertical flex two><i18n-msg msgid="badge-pickup">Badge pick-up</i18-msg></span>
                    </div>
                    <div layout vertical?="{{isPhoneSize}}" horizontal?="{{!isPhoneSize}}">
                      <span class="schedule-time" auto-vertical flex>9:00 AM - 5:00 PM</span>
                      <span auto-vertical flex two><i18n-msg msgid="sessions-sandbox">Sessions &amp; Sandbox</i18-msg></span>
                    </div>
                    <div layout vertical?="{{isPhoneSize}}" horizontal?="{{!isPhoneSize}}">
                      <span class="schedule-time" auto-vertical flex>11:30 AM - 1:30 PM</span>
                      <span auto-vertical flex two><i18n-msg msgid="lunch">Lunch</i18-msg></span>
                    </div>
                    <div layout vertical?="{{isPhoneSize}}" horizontal?="{{!isPhoneSize}}">
                      <span class="schedule-time" auto-vertical flex>6:30 PM - 10:00 PM</span>
                      <span auto-vertical flex two><i18n-msg msgid="afterhours">After Hours</i18-msg></span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
        <section class="page__section">
          <div class="card__container card__container--top">
            <div class="card js-experiment-visualizer">
              <div class="card-content">
                <h4><i18n-msg msgid="iomonth">May</i18-msg> 29, 2015</h4>
              </div>
              <div class="card-content">
                <div layout horizontal>
                  <core-icon icon="schedule" aria-hidden="true"></core-icon>
                  <div class="schedule-rows">
                    <div layout vertical?="{{isPhoneSize}}" horizontal?="{{!isPhoneSize}}">
                      <span class="schedule-time" auto-vertical flex>9:00 AM - 5:00 PM</span>
                      <span auto-vertical flex two><i18n-msg msgid="sessions-sandbox">Sessions &amp; Sandbox</i18-msg></span>
                    </div>
                    <div layout vertical?="{{isPhoneSize}}" horizontal?="{{!isPhoneSize}}">
                      <span class="schedule-time" auto-vertical flex>11:30 AM - 1:30 PM</span>
                      <span auto-vertical flex two><i18n-msg msgid="lunch">Lunch</i18-msg></span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
    </section>
    <section id="subpage-day1" class="subpage__content {{ {active: pages[selectedPage].selectedSubpage == 'day1'} | tokenList}}">
      <section class="page__section page__section--top slide-up">
        <div class="card__container card__container--top">
          <div class="card js-experiment-visualizer">
            <div class="card-content">
              <h3 class="card__title">Create your schedule</h3>
              <div>Sign-in to add sessions to your personalized schedule and to view it in your time zone.</div>
            </div>
            <div class="card-content">
              <span class="anchor-like" role="link" tabindex="0" data-track-link="schedule-sign-in">
                Sign-in to create your schedule
              </span>
            </div>
          </div>
        </div>
      </section>
      <div class="slide-up-delay">
        <section class="page__section">

        <div class="card__container sidebyside" layout horizontal>
          <div flex layout vertical>
            <section class="page__section">
              <div class="card">
                <div class="card-content">
                  <h4>10 AM</h4>
                </div>
                <div class="card-content">
                  <div layout horizontal>
                    <div class="schedule-rows">
                      <div layout vertical?="{{isPhoneSize}}" horizontal?="{{!isPhoneSize}}">
                        <span class="" auto-vertical flex>
                          <paper-radio-button name="" role="radio"
                        tabindex="0" aria-checked="false"
                        aria-label="" class=""></paper-radio-button>
                        </span>
                        <span class="schedule-time" auto-vertical flex>8:00 AM - 9:00 AM</span>
                        <span auto-vertical flex two><i18n-msg msgid="badge-pickup">Badge pick-up</i18-msg></span>
                      </div>

                      <div layout vertical?="{{isPhoneSize}}" horizontal?="{{!isPhoneSize}}">
                        <span class="" auto-vertical flex>
                          <paper-radio-button name="" role="radio"
                        tabindex="0" aria-checked="false"
                        aria-label="" class=""></paper-radio-button>
                        </span>
                        <span class="schedule-time" auto-vertical flex>11:30 AM - 1:30 PM</span>
                        <span auto-vertical flex two><i18n-msg msgid="lunch">Lunch</i18-msg></span>
                      </div>
                      <div layout vertical?="{{isPhoneSize}}" horizontal?="{{!isPhoneSize}}">
                        <span class="" auto-vertical flex>
                          <paper-radio-button name="" role="radio"
                        tabindex="0" aria-checked="false"
                        aria-label="" class=""></paper-radio-button>
                        </span>
                        <span class="schedule-time" auto-vertical flex>6:30 PM - 10:00 PM</span>
                        <span auto-vertical flex two><i18n-msg msgid="afterhours">After Hours</i18-msg></span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </section>
            <div class="card">
              <div class="card-content">
                <h4>10 AM</h4>
              </div>
              <div class="card-content">
                <div layout horizontal>
                  <div class="schedule-rows">
                    <div layout vertical?="{{isPhoneSize}}" horizontal?="{{!isPhoneSize}}">
                      <span class="" auto-vertical flex>
                        <paper-radio-button name="" role="radio"
                      tabindex="0" aria-checked="false"
                      aria-label="" class=""></paper-radio-button>
                      </span>
                      <span class="schedule-time" auto-vertical flex>8:00 AM - 9:00 AM</span>
                      <span auto-vertical flex two><i18n-msg msgid="badge-pickup">Badge pick-up</i18-msg></span>
                    </div>
                    <div layout vertical?="{{isPhoneSize}}" horizontal?="{{!isPhoneSize}}">
                      <span class="" auto-vertical flex>
                        <paper-radio-button name="" role="radio"
                      tabindex="0" aria-checked="false"
                      aria-label="" class=""></paper-radio-button>
                      </span>
                      <span class="schedule-time" auto-vertical flex>9:00 AM - 5:00 PM</span>
                      <span auto-vertical flex two><i18n-msg msgid="sessions-sandbox">Sessions &amp; Sandbox</i18-msg></span>
                    </div>
                    <div layout vertical?="{{isPhoneSize}}" horizontal?="{{!isPhoneSize}}">
                      <span class="" auto-vertical flex>
                        <paper-radio-button name="" role="radio"
                      tabindex="0" aria-checked="false"
                      aria-label="" class=""></paper-radio-button>
                      </span>
                      <span class="schedule-time" auto-vertical flex>11:30 AM - 1:30 PM</span>
                      <span auto-vertical flex two><i18n-msg msgid="lunch">Lunch</i18-msg></span>
                    </div>
                    <div layout vertical?="{{isPhoneSize}}" horizontal?="{{!isPhoneSize}}">
                      <span class="" auto-vertical flex>
                        <paper-radio-button name="" role="radio"
                      tabindex="0" aria-checked="false"
                      aria-label="" class=""></paper-radio-button>
                      </span>
                      <span class="schedule-time" auto-vertical flex>6:30 PM - 10:00 PM</span>
                      <span auto-vertical flex two><i18n-msg msgid="afterhours">After Hours</i18-msg></span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="card__container" layout vertical>
            <div class="card js-experiment-visualizer">
              <div class="card-content">
                <h4>Filters</h4>
              </div>
              <div class="card-content">
                <div layout horizontal>
                  <div class="schedule-rows">
                    <core-label center="" horizontal="" layout="" id="core-label-5">
                      <div flex="">Design</div>
                      <paper-checkbox class="blue" checked="" for="" role="checkbox" tabindex="0" aria-checked="true" aria-labelledby="core-label-5"></paper-checkbox>
                    </core-label>
                    <core-label center="" horizontal="" layout="" id="core-label-5">
                      <div flex="">Design</div>
                      <paper-checkbox class="blue" for="" role="checkbox" tabindex="0" aria-checked="true" aria-labelledby="core-label-5"></paper-checkbox>
                    </core-label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>
  </section>
</div>
<script>
  (function() {

    // Example id: dc44916c-48e7-e311-b297-00155d5066d7
    var SESSION_ID_REGEX = /\w{8}-(\w{4}-){3}\w{12}$/;

    var SUBTAB_SELECTOR = '#subpage-tabs a';

    // Page-specific JS that runs when this page is loaded for the first time.
    function initPage() {
      var page = IOWA.Elements.Template.pages[IOWA.Elements.Template.selectedPage];

      if (page.hasBeenLoaded) {
        return;
      }

      var onPageTransitionDone_ = function(e) {
        document.removeEventListener('page-transition-done', onPageTransitionDone_);

        IOWA.Schedule.fetchSchedule().then(function(scheduleData) {

          IOWA.Elements.Template.scheduleData = scheduleData;

          // Deep link into session.
          var sessionId = location.hash.substring(1).match(SESSION_ID_REGEX);
          if (sessionId) {
            IOWA.Elements.Template.openSession(sessionId[0]);
          }
        });

        // TODO(ericbidelman): also fetch user signed-in data.
        // IOWA.Schedule.fetchUserSchedule.then(function(scheduleData) {});
      };

      page.load = function() {
        // Reset template variables for when revisiting the page.
        IOWA.Elements.Template.selectedSession = null;
        IOWA.Elements.Template.scheduleData = null;

        document.addEventListener('page-transition-done', onPageTransitionDone_);

        // Wait 1 rAF for template to stamp.
        IOWA.Elements.Template.async(function() {
          IOWA.A11y.addFocusStates(SUBTAB_SELECTOR);
        });
      };

      page.unload = function() {
        IOWA.A11y.removeFocusStates(SUBTAB_SELECTOR);
      };

      IOWA.Elements.Template.openSession = function(sessionId) {
        this.selectedSession = this.scheduleData.sessions[sessionId];
        IOWA.Elements.Main.querySelector('.session__detail').open();
      };

      IOWA.Elements.Template.toggleSaveSession = function(e, detail, sender) {
        e.stopPropagation();

        var selectedSession = IOWA.Elements.Template.selectedSession;

        // TODO(ericbidelman): get session object from API.
        var saved = !!selectedSession.saved;
        selectedSession.saved = !saved;

        IOWA.Schedule.saveSession(selectedSession.id, selectedSession.saved);
      };

      IOWA.Elements.Template.onSessionDetailsClose = function(e, detail, sender) {
        history.replaceState({}, null, location.pathname); // Remove session id hash from URL.
      };

      page.load(); // Run load callback on page load.
      page.hasBeenLoaded = true;
    }

    // IE will be "loading" at this point. Other browsers will already be "complete".
    if (document.readyState !== 'loading') {
      initPage();
    }

    // Necessary for IE's lack of native <template>
    // https://github.com/GoogleChrome/ioweb2015/issues/599
    window._initPage = initPage;
  })();
  </script>
{% end %}
